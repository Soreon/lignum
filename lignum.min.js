export default class Lignum{container=null;data=null;options=null;get hasCheckbox(){return this.options&&!0===this.options.checkbox}get onLabelClick(){return this.options&&this.option?this.options.labelClick:null}get onImgClick(){return this.options&&this.option?this.options.imgClick:null}constructor(e,t,n){this.container=e,t&&(this.options=t),n&&(this.data=n,this.generate(this.container,this.data))}static emitEvent(e,t){const n=document.createEvent("HTMLEvents");n.initEvent(t,!1,!0),console.log(t,e),e.dispatchEvent(n)}checkChildren(e){const t=e.querySelector(".lignum-node-children");if(t){const n=t.querySelectorAll("input[type=checkbox]"),i=e.querySelector("input[type=checkbox]");for(let e=0;e<n.length;e+=1)n[e].checked===i.checked&&!1===n[e].indeterminate||Lignum.emitEvent(n[e],"change"),n[e].checked=i.checked,n[e].indeterminate=!1,n[e].indeterminate?Lignum.emitEvent(n[e],"indeterminate"):n[e].checked?Lignum.emitEvent(n[e],"checked"):Lignum.emitEvent(n[e],"unchecked")}this.refreshAncestors(e)}refreshAncestors(e){const t=e.parentNode.parentNode;if(!t.classList.contains("lignum-node"))return;const n=t.querySelector("input[type=checkbox]"),i=t.querySelector(".lignum-node-children").querySelectorAll(":scope .lignum-node");let c=!0,a=!1,l=!1;for(let e=0;e<i.length;e+=1){const t=i[e].querySelector("input[type=checkbox]");c&=t.checked,a|=t.checked,l|=t.indeterminate}const s=l||!c&&a,d=c;s===n.indeterminate&&d===n.checked||Lignum.emitEvent(n,"change"),n.indeterminate=s,n.checked=d,s?Lignum.emitEvent(n,"indeterminate"):d?Lignum.emitEvent(n,"checked"):Lignum.emitEvent(n,"unchecked"),this.refreshAncestors(t)}generate(e,t){if(!Array.isArray(t))throw new Error("Data is not an array");e.innerHTML="",e.classList.add("lignum-container");const n=document.createElement("div");n.classList.add("lignum-node-vertical-dotted-line"),e.appendChild(n);for(let n=0;n<t.length;n+=1){const i=t[n],c=i.children&&i.children.length>0,a=i.img&&i.img.length>0,l=document.createElement("div");l.classList.add("lignum-node-horizontal-dotted-line");const s=document.createElement("button");s.classList.add("lignum-node-button"),s.innerText="+";let d=null;if(this.hasCheckbox)switch(d=document.createElement("input"),d.type="checkbox",d.classList.add("lignum-node-checkbox"),i.checkboxState){case"unchecked":d.checked=!1;break;case"indeterminate":d.indeterminate=!0;break;case"checked":default:d.checked=!0}let o=null;a&&(o=document.createElement("img"),o.classList.add("lignum-node-img"),o.src=i.img);const r=document.createElement("span");r.classList.add("lignum-node-label"),this.hasCheckbox||c||r.classList.add("lignum-node-naked-label"),r.innerText=i.name;const h=document.createElement("div");h.classList.add("lignum-node-ui");for(let e=0;i.data&&e<i.data.length;e+=1){const{key:t,value:n}=i.data[e];h.dataset[t]=n}c||h.classList.add("childless"),h.appendChild(l),c&&h.appendChild(s),this.hasCheckbox&&h.appendChild(d),a&&h.appendChild(o),h.appendChild(r);const m=document.createElement("div");m.classList.add("lignum-node-children"),c&&this.generate(m,i.children);const g=document.createElement("div");g.classList.add("lignum-node"),"open"!==i.nodeState&&g.classList.add("close"),g.appendChild(h),c&&g.appendChild(m),s.addEventListener("click",(e=>{s.innerText="+"===s.innerText?"-":"+",g.classList.toggle("close"),i.nodeState=g.classList.contains("close")?"close":"open",Lignum.emitEvent(e.target,g.classList.contains("close")?"close":"open"),Lignum.emitEvent(e.target,"change")})),this.hasCheckbox&&d.addEventListener("click",(e=>{e.target.indeterminate?(i.checkboxState="indeterminate",Lignum.emitEvent(e.target,"indeterminate")):e.target.checked?(i.checkboxState="checked",Lignum.emitEvent(e.target,"checked")):(i.checkboxState="unchecked",Lignum.emitEvent(e.target,"unchecked")),Lignum.emitEvent(e.target,"change"),this.checkChildren(e.target.parentElement.parentElement)})),r.addEventListener("click",(()=>{"toggleCheckbox"===this.onLabelClick?d.click():"toggleWrap"===this.onLabelClick&&s.click()})),a&&o.addEventListener("click",(()=>{"toggleCheckbox"===this.onImgClick?d.click():"toggleWrap"===this.onImgClick&&s.click()})),e.appendChild(g)}}}
