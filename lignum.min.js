"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports["default"]=void 0;function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}var Lignum=function(){_createClass(Lignum,[{key:"hasCheckbox",get:function get(){return this.options&&this.options.checkbox===true}},{key:"onLabelClick",get:function get(){if(this.options&&this.option){return this.options.labelClick}return null}},{key:"onImgClick",get:function get(){if(this.options&&this.option){return this.options.imgClick}return null}}]);function Lignum(container,options,data){_classCallCheck(this,Lignum);_defineProperty(this,"container",null);_defineProperty(this,"data",null);_defineProperty(this,"options",null);this.updateContainer(container);if(options)this.options=options;if(data){this.data=data;this.generate(this.container,this.data)}}_createClass(Lignum,[{key:"checkChildren",value:function checkChildren(node){var childrenContainer=node.querySelector(".lignum-node-children");if(childrenContainer){var childrenCheckboxes=childrenContainer.querySelectorAll("input[type=checkbox]");var nodeCheckbox=node.querySelector("input[type=checkbox]");for(var i=0;i<childrenCheckboxes.length;i+=1){if(childrenCheckboxes[i].checked!==nodeCheckbox.checked||childrenCheckboxes[i].indeterminate!==false){this.emitEvent(childrenCheckboxes[i],"change")}childrenCheckboxes[i].checked=nodeCheckbox.checked;childrenCheckboxes[i].indeterminate=false;if(childrenCheckboxes[i].indeterminate){this.emitEvent(childrenCheckboxes[i],"indeterminate")}else if(childrenCheckboxes[i].checked){this.emitEvent(childrenCheckboxes[i],"checked")}else{this.emitEvent(childrenCheckboxes[i],"unchecked")}}}this.refreshAncestors(node)}},{key:"refreshAncestors",value:function refreshAncestors(node){var parent=node.parentNode.parentNode;if(!parent.classList.contains("lignum-node"))return;var parentCheckbox=parent.querySelector("input[type=checkbox]");var childrenContainer=parent.querySelector(".lignum-node-children");var children=childrenContainer.querySelectorAll(":scope .lignum-node");var allChecked=true;var atLeastOneChecked=false;var atLeastOneIndeterminate=false;for(var i=0;i<children.length;i+=1){var childCheckbox=children[i].querySelector("input[type=checkbox]");allChecked&=childCheckbox.checked;atLeastOneChecked|=childCheckbox.checked;atLeastOneIndeterminate|=childCheckbox.indeterminate}var indeterminate=atLeastOneIndeterminate||!allChecked&&atLeastOneChecked;var checked=allChecked;if(indeterminate!==parentCheckbox.indeterminate||checked!==parentCheckbox.checked){this.emitEvent(parentCheckbox,"change")}parentCheckbox.indeterminate=indeterminate;parentCheckbox.checked=checked;if(indeterminate){this.emitEvent(parentCheckbox,"indeterminate")}else if(checked){this.emitEvent(parentCheckbox,"checked")}else{this.emitEvent(parentCheckbox,"unchecked")}this.refreshAncestors(parent)}},{key:"updateContainer",value:function updateContainer(container){if(typeof container!=="string")throw new Error("Wrong format for the container's id");this.container=document.querySelector(container);if(!this.container)throw new Error("Cannot find the container ".concat(container));this.emitEvent(this.container,"containerUpdated")}},{key:"updateData",value:function updateData(data){this.data=data;this.emitEvent(this.container,"dataUpdated")}},{key:"refresh",value:function refresh(){this.generate(this.container,this.data);this.emitEvent(this.container,"treeRefreshed")}},{key:"generate",value:function generate(container,data){var _this=this;if(!Array.isArray(data))throw new Error("Data is not an array");container.innerHTML="";container.classList.add("lignum-container");var verticalDottedLine=document.createElement("div");verticalDottedLine.classList.add("lignum-node-vertical-dotted-line");container.appendChild(verticalDottedLine);var _loop=function _loop(i){var item=data[i];var hasChildren=item.children&&item.children.length>0;var hasImage=item.img&&item.img.length>0;var horizontalDottedLine=document.createElement("div");horizontalDottedLine.classList.add("lignum-node-horizontal-dotted-line");var btn=document.createElement("button");btn.classList.add("lignum-node-button");btn.innerText="+";var chk=null;if(_this.hasCheckbox){chk=document.createElement("input");chk.type="checkbox";chk.classList.add("lignum-node-checkbox");switch(item.checkboxState){case"unchecked":chk.checked=false;break;case"indeterminate":chk.indeterminate=true;break;case"checked":default:chk.checked=true;break;}}var img=null;if(hasImage){img=document.createElement("img");img.classList.add("lignum-node-img");img.src=item.img}var lbl=document.createElement("span");lbl.classList.add("lignum-node-label");if(!_this.hasCheckbox&&!hasChildren)lbl.classList.add("lignum-node-naked-label");lbl.innerText=item.name;var bil=document.createElement("div");bil.classList.add("lignum-node-ui");for(var j=0;item.data&&j<item.data.length;j+=1){var _item$data$j=item.data[j],key=_item$data$j.key,value=_item$data$j.value;bil.dataset[key]=value}if(!hasChildren)bil.classList.add("childless");bil.appendChild(horizontalDottedLine);if(hasChildren)bil.appendChild(btn);if(_this.hasCheckbox)bil.appendChild(chk);if(hasImage)bil.appendChild(img);bil.appendChild(lbl);var chl=document.createElement("div");chl.classList.add("lignum-node-children");if(hasChildren)_this.generate(chl,item.children);var node=document.createElement("div");node.classList.add("lignum-node");if(item.nodeState!=="open")node.classList.add("close");node.appendChild(bil);if(hasChildren)node.appendChild(chl);btn.addEventListener("click",function(e){btn.innerText=btn.innerText==="+"?"-":"+";node.classList.toggle("close");item.nodeState=node.classList.contains("close")?"close":"open";_this.emitEvent(e.target,node.classList.contains("close")?"close":"open");_this.emitEvent(e.target,"change")});if(_this.hasCheckbox){chk.addEventListener("click",function(e){if(e.target.indeterminate){item.checkboxState="indeterminate";_this.emitEvent(e.target,"indeterminate")}else if(e.target.checked){item.checkboxState="checked";_this.emitEvent(e.target,"checked")}else{item.checkboxState="unchecked";_this.emitEvent(e.target,"unchecked")}_this.emitEvent(e.target,"change");_this.checkChildren(e.target.parentElement.parentElement)})}lbl.addEventListener("click",function(){if(_this.onLabelClick==="toggleCheckbox"){chk.click()}else if(_this.onLabelClick==="toggleWrap"){btn.click()}});if(hasImage){img.addEventListener("click",function(){if(_this.onImgClick==="toggleCheckbox"){chk.click()}else if(_this.onImgClick==="toggleWrap"){btn.click()}})}container.appendChild(node)};for(var i=0;i<data.length;i+=1){_loop(i)}}}],[{key:"emitEvent",value:function emitEvent(element,eventName){var event=document.createEvent("HTMLEvents");event.initEvent(eventName,false,true);console.log(eventName,element);element.dispatchEvent(event)}}]);return Lignum}();exports["default"]=Lignum;
