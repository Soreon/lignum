export default class Lignum{container=null;data=null;options=null;constructor(e,t,n){this.container=e,this.data=n,this.options=t,this.generate(this.container,this.data)}static emitEvent(e,t){const n=document.createEvent("HTMLEvents");n.initEvent(t,!1,!0),console.log(t,e),e.dispatchEvent(n)}checkChildren(e){const t=e.querySelector(".lignum-node-children");if(t){const n=t.querySelectorAll("input[type=checkbox]"),i=e.querySelector("input[type=checkbox]");for(let e=0;e<n.length;e+=1)n[e].checked===i.checked&&!1===n[e].indeterminate||Lignum.emitEvent(n[e],"change"),n[e].checked=i.checked,n[e].indeterminate=!1,n[e].indeterminate?Lignum.emitEvent(n[e],"indeterminate"):n[e].checked?Lignum.emitEvent(n[e],"checked"):Lignum.emitEvent(n[e],"unchecked")}this.refreshAncestors(e)}refreshAncestors(e){const t=e.parentNode.parentNode;if(!t.classList.contains("lignum-node"))return;const n=t.querySelector("input[type=checkbox]"),i=t.querySelector(".lignum-node-children").querySelectorAll(":scope .lignum-node");let c=!0,d=!1,s=!1;for(let e=0;e<i.length;e+=1){const t=i[e].querySelector("input[type=checkbox]");c&=t.checked,d|=t.checked,s|=t.indeterminate}const l=s||!c&&d,a=c;l===n.indeterminate&&a===n.checked||Lignum.emitEvent(n,"change"),n.indeterminate=l,n.checked=a,l?Lignum.emitEvent(n,"indeterminate"):a?Lignum.emitEvent(n,"checked"):Lignum.emitEvent(n,"unchecked"),this.refreshAncestors(t)}generate(e,t){if(!Array.isArray(t))throw new Error("Data is not an array");e.innerHTML="",e.classList.add("lignum-container");const n=this.options&&!0===this.options.checkbox,i=this.options&&"toggleCheckbox"===this.options.labelClick,c=this.options&&"toggleWrap"===this.options.labelClick,d=this.options&&"toggleCheckbox"===this.options.imgClick,s=this.options&&"toggleWrap"===this.options.imgClick,l=document.createElement("div");l.classList.add("lignum-node-vertical-dotted-line"),e.appendChild(l);for(let l=0;l<t.length;l+=1){const a=t[l].children&&t[l].children.length>0,o=t[l].img&&t[l].img.length>0,r=document.createElement("div");r.classList.add("lignum-node-horizontal-dotted-line");const h=document.createElement("button");h.classList.add("lignum-node-button"),h.innerText="+";let m=null;if(n)switch(m=document.createElement("input"),m.type="checkbox",m.classList.add("lignum-node-checkbox"),t[l].checkboxState){case"unchecked":m.checked=!1;break;case"indeterminate":m.indeterminate=!0;break;case"checked":default:m.checked=!0}let g=null;o&&(g=document.createElement("img"),g.classList.add("lignum-node-img"),g.src=t[l].img);const u=document.createElement("span");u.classList.add("lignum-node-label"),n||a||u.classList.add("lignum-node-naked-label"),u.innerText=t[l].name;const p=document.createElement("div");p.classList.add("lignum-node-ui"),a||p.classList.add("childless"),p.appendChild(r),a&&p.appendChild(h),n&&p.appendChild(m),o&&p.appendChild(g),p.appendChild(u);const k=document.createElement("div");k.classList.add("lignum-node-children"),a&&this.generate(k,t[l].children);const L=document.createElement("div");L.classList.add("lignum-node"),"open"!==t[l].nodeState&&L.classList.add("close"),L.appendChild(p),a&&L.appendChild(k),h.addEventListener("click",(e=>{h.innerText="+"===h.innerText?"-":"+",L.classList.toggle("close"),t[l].nodeState=L.classList.contains("close")?"close":"open",Lignum.emitEvent(e.target,L.classList.contains("close")?"close":"open"),Lignum.emitEvent(e.target,"change")})),n&&m.addEventListener("click",(e=>{e.target.indeterminate?(t[l].checkboxState="indeterminate",Lignum.emitEvent(e.target,"indeterminate")):e.target.checked?(t[l].checkboxState="checked",Lignum.emitEvent(e.target,"checked")):(t[l].checkboxState="unchecked",Lignum.emitEvent(e.target,"unchecked")),Lignum.emitEvent(e.target,"change"),this.checkChildren(e.target.parentElement.parentElement)})),u.addEventListener("click",(()=>{i?m.click():c&&h.click()})),o&&g.addEventListener("click",(()=>{d?m.click():s&&h.click()})),e.appendChild(L)}}}
