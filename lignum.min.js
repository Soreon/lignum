export default class Lignum{container=null;data=null;options=null;constructor(e,t,n){this.container=e,this.data=n,this.options=t,this.generate(this.container,this.data)}static emitEvent(e,t){const n=document.createEvent("HTMLEvents");n.initEvent(t,!1,!0),console.log(t,e),e.dispatchEvent(n)}checkChildren(e){const t=e.querySelector(".lignum-node-children");if(t){const n=t.querySelectorAll("input[type=checkbox]"),i=e.querySelector("input[type=checkbox]");for(let e=0;e<n.length;e+=1)n[e].checked===i.checked&&!1===n[e].indeterminate||Lignum.emitEvent(n[e],"change"),n[e].checked=i.checked,n[e].indeterminate=!1,n[e].indeterminate?Lignum.emitEvent(n[e],"indeterminate"):n[e].checked?Lignum.emitEvent(n[e],"checked"):Lignum.emitEvent(n[e],"unchecked")}this.refreshAncestors(e)}refreshAncestors(e){const t=e.parentNode.parentNode;if(!t.classList.contains("lignum-node"))return;const n=t.querySelector("input[type=checkbox]"),i=t.querySelector(".lignum-node-children").querySelectorAll(":scope .lignum-node");let c=!0,d=!1,a=!1;for(let e=0;e<i.length;e+=1){const t=i[e].querySelector("input[type=checkbox]");c&=t.checked,d|=t.checked,a|=t.indeterminate}const s=a||!c&&d,l=c;s===n.indeterminate&&l===n.checked||Lignum.emitEvent(n,"change"),n.indeterminate=s,n.checked=l,s?Lignum.emitEvent(n,"indeterminate"):l?Lignum.emitEvent(n,"checked"):Lignum.emitEvent(n,"unchecked"),this.refreshAncestors(t)}generate(e,t){if(!Array.isArray(t))throw new Error("Data is not an array");e.innerHTML="",e.classList.add("lignum-container");const n=this.options&&!0===this.options.checkbox,i=this.options&&"toggleCheckbox"===this.options.labelClick,c=this.options&&"toggleWrap"===this.options.labelClick,d=this.options&&"toggleCheckbox"===this.options.imgClick,a=this.options&&"toggleWrap"===this.options.imgClick,s=document.createElement("div");s.classList.add("lignum-node-vertical-dotted-line"),e.appendChild(s);for(let s=0;s<t.length;s+=1){const l=t[s],o=l.children&&l.children.length>0,r=l.img&&l.img.length>0,h=document.createElement("div");h.classList.add("lignum-node-horizontal-dotted-line");const m=document.createElement("button");m.classList.add("lignum-node-button"),m.innerText="+";let g=null;if(n)switch(g=document.createElement("input"),g.type="checkbox",g.classList.add("lignum-node-checkbox"),l.checkboxState){case"unchecked":g.checked=!1;break;case"indeterminate":g.indeterminate=!0;break;case"checked":default:g.checked=!0}let u=null;r&&(u=document.createElement("img"),u.classList.add("lignum-node-img"),u.src=l.img);const k=document.createElement("span");k.classList.add("lignum-node-label"),n||o||k.classList.add("lignum-node-naked-label"),k.innerText=l.name;const p=document.createElement("div");p.classList.add("lignum-node-ui");for(let e=0;l.data&&e<l.data.length;e+=1){const{key:t,value:n}=l.data[e];p.dataset[t]=n}o||p.classList.add("childless"),p.appendChild(h),o&&p.appendChild(m),n&&p.appendChild(g),r&&p.appendChild(u),p.appendChild(k);const L=document.createElement("div");L.classList.add("lignum-node-children"),o&&this.generate(L,l.children);const E=document.createElement("div");E.classList.add("lignum-node"),"open"!==l.nodeState&&E.classList.add("close"),E.appendChild(p),o&&E.appendChild(L),m.addEventListener("click",(e=>{m.innerText="+"===m.innerText?"-":"+",E.classList.toggle("close"),l.nodeState=E.classList.contains("close")?"close":"open",Lignum.emitEvent(e.target,E.classList.contains("close")?"close":"open"),Lignum.emitEvent(e.target,"change")})),n&&g.addEventListener("click",(e=>{e.target.indeterminate?(l.checkboxState="indeterminate",Lignum.emitEvent(e.target,"indeterminate")):e.target.checked?(l.checkboxState="checked",Lignum.emitEvent(e.target,"checked")):(l.checkboxState="unchecked",Lignum.emitEvent(e.target,"unchecked")),Lignum.emitEvent(e.target,"change"),this.checkChildren(e.target.parentElement.parentElement)})),k.addEventListener("click",(()=>{i?g.click():c&&m.click()})),r&&u.addEventListener("click",(()=>{d?g.click():a&&m.click()})),e.appendChild(E)}}}
